# Data Generation Scripts

This directory contains utility scripts for the nod-chat project.

## Project Structure

```
packages/scripts/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Main orchestrator
â”‚   â”œâ”€â”€ config.ts             # Configuration and constants
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â””â”€â”€ genkit.ts         # AI generation (Gemini)
â”‚   â”œâ”€â”€ generators/
â”‚   â”‚   â”œâ”€â”€ users.ts          # User creation
â”‚   â”‚   â”œâ”€â”€ chats.ts          # One-on-one chat creation
â”‚   â”‚   â”œâ”€â”€ groups.ts         # Group chat creation
â”‚   â”‚   â””â”€â”€ messages.ts       # Message generation
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ helpers.ts        # Utility functions
â”‚       â””â”€â”€ messages.ts       # Message templates
â”œâ”€â”€ .env.example              # Environment variables template
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## Generate Test Data

This script seeds Firebase emulators with test users and realistic chat data.

### Available Commands

| Command            | Description                        | Creates                      |
| ------------------ | ---------------------------------- | ---------------------------- |
| `pnpm seed`        | Full seed (users + chats + groups) | 20 users, 18 chats, 6 groups |
| `pnpm seed:chats`  | Add chats to existing users        | 18 additional chats          |
| `pnpm seed:groups` | Add groups to existing users       | 6 additional groups          |

### Prerequisites

1. **Install dependencies:**

   ```bash
   pnpm install
   ```

2. **Start Firebase emulators:**

   ```bash
   # From project root
   pnpm emulators
   ```

   Make sure the emulators are running before executing the seed script.

### Usage

**Basic (Template-based generation):**

```bash
pnpm seed
```

**With AI (Gemini-powered generation):**

**Option 1 - Using .env file (easiest):**

1. Create `.env` file in `packages/scripts/`:
   ```bash
   GOOGLE_API_KEY=your_key_here
   USE_AI=true
   ```
2. Run: `pnpm seed`

**Option 2 - Command line:**

```bash
USE_AI=true GOOGLE_API_KEY=your_key pnpm seed
```

**From packages/scripts directory:**

```bash
cd packages/scripts
pnpm seed
# or with AI:
USE_AI=true pnpm seed
```

**Windows PowerShell:**

```powershell
$env:USE_AI="true"
pnpm seed
```

> **Note:** AI generation requires Vertex AI setup. See [VERTEX_AI_SETUP.md](./VERTEX_AI_SETUP.md) for detailed instructions.

### What Gets Created

- **30 test users** with credentials:
  - Full names generated by Faker (e.g., "John Smith", "Sarah Johnson")
  - Email: `<firstname>@<firstname>.com` (e.g., `john@john.com`)
  - Password: `password`
  - Profile pictures generated with UI Avatars

- **~18 one-on-one chats** with:
  - 20-50 messages each
  - Random participants
  - Messages spread over 1-7 days

- **~6 group chats** with:
  - 4-8 members each
  - 30-50 messages each
  - Realistic group names
  - Random admin assignments

- **Realistic message content:**
  - Generated using faker library
  - ~20% include images (placeholder URLs)
  - Timestamps distributed naturally over time
  - Varied message lengths and styles

### Test User Accounts

After running the script, check the Firebase Emulator UI (http://localhost:4000) under Authentication to see the generated user emails. All users have the password `password`.

Example accounts (generated randomly each time):

- `john@john.com` / `password`
- `sarah@sarah.com` / `password`
- etc.

The email format is always `<firstname>@<firstname>.com` where firstname is the first name from the generated full name.

### Customization

Edit `generate-data.ts` to adjust:

- Number of chats and groups (change `NUM_USERS`, `TARGET_ONE_ON_ONE_CHATS`, `TARGET_GROUPS`)
- Message counts (change `MESSAGES_PER_CHAT_MIN/MAX`, `MESSAGES_PER_GROUP_MIN/MAX`)
- Image probability (change `IMAGE_PROBABILITY`)
- Time ranges (change `DAYS_AGO_MIN/MAX`)
- Profile picture service (switch between DiceBear, Pravatar, etc.)
- Message templates (add your own in `generateRealisticMessage()`)
- Group name templates (add your own in `createGroups()`)

### Data Generated

The script creates data specifically tailored for **professional remote teams**:

**Messages include:**

- Meeting coordination ("Meeting in 10 minutes", "Can we schedule a call?")
- Project updates ("Just pushed to staging", "Feature ready for review")
- Status updates ("Almost done with the implementation", "All tests passing")
- Time-based messages ("Taking lunch", "Logging off for the day")
- Collaboration ("Can someone review my PR?", "Need help with the API")
- Team culture ("Great work!", "Happy Friday! ðŸŽ‰")

**Group names include:**

- Team names (Engineering Team, Design Squad)
- Project groups (Project [Name], Alpha Team)
- Meeting channels (Standup, All Hands)
- Location-based (San Francisco Office)

**Profile pictures:**

- AI-generated realistic avatars via DiceBear
- Alternative services available (see code comments)

### AI-Powered Generation (Optional)

The script supports **Google Gemini AI** for ultra-realistic data generation:

**What AI generates:**

- Context-aware conversations between team members
- Natural, multi-turn discussions
- Realistic group chat names
- Messages that reference each other and build on context
- Uses Gemini 2.5 Flash (latest stable model)

**Setup Instructions:**
See [GENKIT_SETUP.md](./GENKIT_SETUP.md) for step-by-step Google AI setup (super easy!).

**Quick Start (if already set up):**

1. Get API key from [Google AI Studio](https://aistudio.google.com/app/apikey)
2. Set environment variable: `export GOOGLE_API_KEY=your_key_here`
3. Run: `USE_AI=true pnpm seed`

**Comparison:**

| Feature | Template Mode   | AI Mode (Gemini)         |
| ------- | --------------- | ------------------------ |
| Cost    | Free            | FREE (or ~$0.05/run)     |
| Setup   | None required   | Simple API key (5 min)   |
| Quality | Good variety    | Extremely realistic      |
| Speed   | Fast (~10s)     | Slower (~30-60s)         |
| Context | Random messages | Contextual conversations |

**Default:** Template mode (no setup, no cost, still very realistic!)

### Troubleshooting

**Error: "ECONNREFUSED"**

- Make sure Firebase emulators are running: `pnpm emulators`
- Check that emulator ports match: Auth (9099), Firestore (8080)

**Error: "Email already exists"**

- The emulators may have data from a previous run
- Clear emulator data by restarting: Stop emulators and start again

**Script runs but no data appears**

- Verify you're connected to emulators, not production
- Check the emulator UI at http://localhost:4000
